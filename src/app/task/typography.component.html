<body>
  <h2>Liste de vos tâches</h2>

  <div
    class="add-card btn1"
    *ngIf="userOnline.type === 'admin' && projetId"
    [matMenuTriggerFor]="menuAj"
  >
    +
  </div>

  <mat-menu #menuAj="matMenu">
    <!-- <button mat-menu-item [routerLink]="['/option1']">Option 1</button> -->
    <button mat-menu-item data-toggle="modal" data-target="#exampleModal">
      <mat-icon>add</mat-icon>Ajouter une tache
    </button>
    <button mat-menu-item data-toggle="modal" data-target="#CatModal">
      <mat-icon>book</mat-icon>
      Ajouter une categorie
    </button>
  </mat-menu>
  <div class="container">
    <div *ngFor="let task of projectTasks">
      <div class="card">
        <div class="d-flex justify-content-between">
          <h3 class="mx-2">{{ task.title }}</h3>

          <button class="right" [matMenuTriggerFor]="menuCat">
            <mat-icon class="text-dark right">more_vert</mat-icon>
          </button>
        </div>

        <mat-menu #menuCat="matMenu">
          <!-- <button mat-menu-item [routerLink]="['/option1']">Option 1</button> -->
          <button
            mat-menu-item
            data-toggle="modal"
            data-target="#UpdateCatModal"
            (click)="onRecupCat(task.id)"
          >
            <mat-icon>create</mat-icon>Modifier la categorie
          </button>
          <button mat-menu-item (click)="onCatDelete(task.id)">
            <mat-icon>delete</mat-icon>
            Supprimer la tache
          </button>
        </mat-menu>

        <div *ngFor="let tasks of task_array">
          <div *ngIf="tasks.cat_TaskId === task.id">
            <div class="tasks" [ngClass]="{ 'non-editable': tasks.status }">
              <!-- <label class="checkbox-label">
                <input type="checkbox" class="custom-checkbox" />
                <span class="checkbox-custom"></span>
              </label> -->
              <div *ngIf="tasks.status">
                <mat-icon>checkbox</mat-icon>
              </div>
              <span>{{ tasks.title }}</span>

              <button class="button1" [matMenuTriggerFor]="menu">...</button>

              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="onEdit_status(tasks.id)">
                  <mat-icon>checkbox</mat-icon>Valider la tache
                </button>

                <button
                  mat-menu-item
                  data-toggle="modal"
                  data-target="#updateTaskModal"
                  (click)="onRecup(tasks.id)"
                >
                  <mat-icon>create</mat-icon>Modifier la tache
                </button>
                <button
                  mat-menu-item
                  (click)="onClickTask(tasks.id, task.id)"
                  *ngIf="userOnline.type === 'admin'"
                >
                  <mat-icon>group</mat-icon>
                  Voir les membres
                </button>
                <button
                  mat-menu-item
                  (click)="onClickTaskNote(tasks.id, task.id)"
                >
                  <mat-icon>question_answer</mat-icon>
                  Voir les notes de la tache
                </button>
                <button mat-menu-item (click)="onTaskDelete(tasks.id)">
                  <mat-icon>delete</mat-icon>
                  Supprimer la tache
                </button>
              </mat-menu>
            </div>
          </div>
        </div>
        <!-- <div class="d-flex justify-content-center text-center">
          <button
            class="center"
            type="button"
            class="btn btn1"
            data-toggle="modal"
            data-target="#exampleModal"
            data-whatever="@mdo"
            (click)="cat_TaskId = task.id"
          >
            Ajouter une tache
          </button>
        </div> -->
      </div>
    </div>
  </div>

  <div class="m">
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Nouvelle tache</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="modale">
                <label for="nom">Nom:</label>
                <input
                  [(ngModel)]="title"
                  type="text"
                  id="nom"
                  name="nom"
                  placeholder="nom de la tache"
                  required
                />
                <label for="description">Description:</label>
                <textarea
                  cols="55"
                  rows="3"
                  [(ngModel)]="desc"
                  type="text"
                  id="description"
                  name="description"
                  placeholder="description de la tache"
                  required
                ></textarea>
                <label for="nom">Categorie</label>
                <select
                  [(ngModel)]="cat_TaskId"
                  name="categorie"
                  placeholder="Choisissez une categorie"
                >
                  <option *ngFor="let cat of allCat" value="{{ cat.id }}">
                    {{ cat.title }}
                  </option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Fermer
            </button>
            <button
              type="button"
              class="btn btn1"
              data-dismiss="modal"
              (click)="onSubmit()"
            >
              Valider
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<div class="card-container">
  <div *ngFor="let taskUsers of task_by_Users">
    <div *ngIf="!projetId" class="card">
      <div class="d-flex justify-content-start">
        <mat-icon class="mat">book</mat-icon>
        <h6 class="mx-3">{{ taskUsers.title }}</h6>
      </div>

      <div class="description">Description et directives:</div>
      <span>{{ taskUsers.desc }}</span>
    </div>
  </div>
</div>
<!-- <div *ngIf="!projetId">
    <div class="search-container">
      <label for="search">Recherche :</label>
      <input
        type="text"
        id="search"
        [(ngModel)]="searchTerm"
        placeholder="Entrez votre recherche"
      />
    </div>
      <table class="table mx-auto table1">
        <thead>
          <tr>
            <th scope="col">Numéro</th>
            <th scope="col">Tâche</th>
            <th scope="col">Projet</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let taskUsers of task_by_Users; let i = index">
            <th scope="row">{{ i + 1 }}</th>
            <td>{{ taskUsers.title }}</td>
            <td>{{ oneProjet(taskUsers.projetId) }}</td>
          </tr>
        </tbody>
      </table>
    </div>  -->

<div
  class="modal fade"
  id="updateTaskModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="updateTaskModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updateTaskLabel">Modifier la tache</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="modale">
            <label for="nom">Nom:</label>
            <textarea
              cols="30"
              rows="10"
              [(ngModel)]="title"
              type="text"
              id="nom"
              name="nom"
              placeholder="nom de la tache"
              required
            ></textarea>
            <label for="description">Description:</label>
            <input
              [(ngModel)]="desc"
              type="text"
              id="description"
              name="description"
              placeholder="description de la tache"
              required
            />
            <input
              [(ngModel)]="cat_TaskId"
              type="hidden"
              id="cat_TaskId"
              name="cat_TaskId"
              required
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Fermer
        </button>
        <button
          type="button"
          class="btn btn1"
          data-dismiss="modal"
          (click)="onEdit_task()"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="CatModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="CatModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="  CatModalLabel">Nouvelle categorie</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="modale">
            <label for="nom">Nom:</label>
            <input
              [(ngModel)]="title"
              type="text"
              id="nom"
              name="nom"
              placeholder="nom de la categorie"
              required
            />
            <label for="description">Description:</label>
            <textarea
              cols="30"
              rows="10"
              [(ngModel)]="desc"
              type="text"
              id="description"
              name="description"
              placeholder="description de la categorie"
              required
            ></textarea>
            <input
              [(ngModel)]="cat_TaskId"
              type="hidden"
              id="cat_TaskId"
              name="cat_TaskId"
              required
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Fermer
        </button>
        <button
          type="button"
          class="btn btn1"
          data-dismiss="modal"
          (click)="addCat()"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="UpdateCatModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="UpdateCatModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="UpdateCatModalLabel">Nouvelle categorie</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="modale">
            <label for="nom">Nom:</label>
            <input
              [(ngModel)]="title"
              type="text"
              id="nom"
              name="nom"
              placeholder="nom de la categorie"
              required
            />
            <label for="description">Description:</label>
            <textarea
              cols="30"
              rows="10"
              [(ngModel)]="desc"
              type="text"
              id="description"
              name="description"
              placeholder="description de la categorie"
              required
            ></textarea>
            <input
              [(ngModel)]="cat_TaskId"
              type="hidden"
              id="cat_TaskId"
              name="cat_TaskId"
              required
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Fermer
        </button>
        <button
          type="button"
          class="btn btn1"
          data-dismiss="modal"
          (click)="onEdit_Cat()"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="memberModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="memberModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="memberModalLabel">Assigner la tache</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="modale">
            <label for="nom">Membre:</label>
            <input
              matInput
              placeholder="Choisissez un membre"
              [formControl]="memberFormControl"
            />

            <mat-autocomplete
              *ngIf="filteredMembers.length > 0"
              [displayWith]="displayFn"
              [options]="filteredMembers"
            >
              <mat-option
                *ngFor="let member of filteredMembers"
                [value]="member"
              >
                {{ member.nom }} {{ member.prenom }}
              </mat-option>
            </mat-autocomplete>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Fermer
        </button>
        <button
          type="button"
          class="btn btn1"
          data-dismiss="modal"
          (click)="addMemberTask()"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
</div>
